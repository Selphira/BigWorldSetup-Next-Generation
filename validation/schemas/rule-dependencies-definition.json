{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://selphira.github.io/BigWorldSetup-Enhanced-Edition/validation/schemas/dependencies.json",
  "title": "Big World Setup - Enhanced Edition: Dependency Rules",
  "description": "Schema for validating dependency rules files",
  "type": "object",
  "required": ["rules"],
  "additionalProperties": false,
  "properties": {
    "rules": {
      "type": "array",
      "items": {"$ref": "#/definitions/dependencyRule"}
    }
  },
  "definitions": {
    "ruleSeverity": {
      "type": "string",
      "enum": ["error", "warning", "info"],
      "default": "error",
      "description": "Severity level of the rule violation"
    },
    "dependencyMode": {
      "type": "string",
      "enum": ["any", "all"],
      "default": "any",
      "description": "Dependency mode: 'any' requires at least one target component, 'all' requires all target components"
    },
    "rule": {
      "type": "string",
      "pattern": "^[a-zA-Z0-9_#'+-]+\\((?:-|\\d+(?:\\.\\d+)*(?:,\\d+(?:\\.\\d+)*)*)\\)(?:\\s*[&|]\\s*[a-zA-Z0-9_#'+-]+\\((?:-|\\d+(?:\\.\\d+)*(?:,\\d+(?:\\.\\d+)*)*)\\))*\\s*:\\s*[a-zA-Z0-9_#'+-]+\\((?:-|\\d+(?:\\.\\d+)*(?:,\\d+(?:\\.\\d+)*)*)\\)(?:\\s*[&|]\\s*[a-zA-Z0-9_#'+-]+\\((?:-|\\d+(?:\\.\\d+)*(?:,\\d+(?:\\.\\d+)*)*)\\))*$",
      "description": "Rule notation."
    },
    "dependencyRule": {
      "type": "object",
      "required": ["rule"],
      "additionalProperties": false,
      "properties": {
        "rule": {
          "$ref": "#/definitions/rule"
        },
        "mode": {
          "$ref": "#/definitions/dependencyMode"
        },
        "severity": {
          "$ref": "#/definitions/ruleSeverity"
        },
        "description": {
          "type": "string",
          "description": "Human-readable explanation of the rule"
        },
        "translations": {
          "type": "object",
          "description": "Translations per language code",
          "minProperties": 1,
          "patternProperties": {
            "^[a-z]{2}_[A-Z]{2}$": {
              "type": "string",
              "minLength": 1
            }
          },
          "additionalProperties": false
        },
        "source_url": {
          "type": "string",
          "format": "uri",
          "description": "Optional URL for documentation or source reference"
        },
        "implicit_order": {
          "type": "boolean",
          "default": true,
          "description": "Whether dependencies imply installation order (target components must be installed before source components)"
        }
      }
    }
  }
}